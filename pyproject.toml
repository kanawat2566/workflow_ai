# Root config — ruff, pyright, pytest settings
# แต่ละ service inherit จากนี้

[tool.ruff]
target-version = "py312"
line-length = 100
exclude = [".venv", "venv", "__pycache__", "*.egg-info"]

[tool.ruff.lint]
select = [
  "E",    # pycodestyle errors
  "W",    # pycodestyle warnings
  "F",    # pyflakes
  "I",    # isort
  "B",    # flake8-bugbear
  "UP",   # pyupgrade
  "S",    # flake8-bandit (security)
  "N",    # pep8-naming
]
ignore = [
  "S101",  # allow assert in tests
  "B008",  # allow function calls in default args (FastAPI Depends)
]

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["S", "B"]   # relax security rules in tests

[tool.pyright]
pythonVersion = "3.12"
typeCheckingMode = "basic"
reportMissingImports = true
reportMissingTypeStubs = false

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
addopts = [
  "-v",
  "--tb=short",
  "--cov=.",
  "--cov-report=term-missing",
  "--cov-report=xml:coverage.xml",
  "--cov-fail-under=70",    # ← Quality Gate: ต้องมี coverage >= 70%
]
markers = [
  "unit: fast unit tests (no external deps)",
  "integration: requires running services",
  "e2e: end-to-end tests",
]
